<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Select Menu</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #581c87 0%, #1e3a8a 50%, #312e81 100%);
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: absolute;
            inset: 0;
            overflow: hidden;
            z-index: 1;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(34, 211, 238, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }

        .bg-animation::after {
            content: '';
            position: absolute;
            bottom: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite 2s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .main-content {
            position: relative;
            z-index: 10;
        }

        /* Header Styles */
        .header-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        .title-gradient {
            background: linear-gradient(45deg, #22d3ee, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 3s ease-in-out infinite;
        }

        /* Player Card Styles */
        .player-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            min-height: 280px;
        }

        .player-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .player-number {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            text-shadow: 0 0 5px currentColor;
        }

        .player-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 20px;
        }

        .player-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .player-name {
            font-weight: bold;
            font-size: 1.25rem;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .player-name:hover {
            transform: scale(1.05);
        }

        .color-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: transform 0.2s ease;
            margin: 0 auto;
        }

        .color-circle:hover {
            transform: scale(1.1);
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.8);
            border: none;
            color: white;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .player-card:hover .remove-btn {
            opacity: 1;
        }

        .remove-btn:hover {
            background: rgb(239, 68, 68);
            transform: scale(1.1);
        }

        /* Add Player Card */
        .add-player-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 280px;
        }

        .add-player-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.02);
        }

        /* Start Game Button */
        .start-btn {
            background: linear-gradient(45deg, #10b981, #059669);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
            padding: 15px 50px;
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .start-btn:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.25);
            color: white;
        }

        .name-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            text-align: center;
            font-size: 1.25rem;
            font-weight: bold;
            outline: none;
            width: 100%;
            margin-bottom: 20px;
        }

        .name-input:focus {
            border-bottom-color: var(--player-color, #fff);
        }

        /* Fullscreen Modal Styles */
        .fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .fullscreen-modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .current-player {
            color: var(--current-player-color);
            font-size: 1.2rem;
            text-shadow: 0 0 10px var(--current-player-color);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Color Picker Styles */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .color-option {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .color-option.selected::after {
            content: '✓';
            color: white;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        /* Icon Picker Styles */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .icon-option {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .icon-option.selected {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .color-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .icon-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .color-option, .icon-option {
                width: 60px;
                height: 60px;
            }
            
            .icon-option {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="main-content">
        <!-- Header -->
        <div class="container-fluid py-4">
            <div class="row justify-content-center">
                <div class="col-auto">
                    <div class="header-card rounded-4 px-5 py-4">
                        <h1 class="display-3 fw-bold title-gradient mb-2">PLAYER SELECT</h1>
                        <div class="d-flex align-items-center justify-content-center gap-2 text-white-50">
                            <i class="fas fa-users"></i>
                            <span class="fs-5" id="player-count">4 Players</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Players Grid -->
        <div class="container-fluid px-4 py-4">
            <div class="row g-4 justify-content-center" id="players-grid">
                <!-- Player cards will be inserted here -->
            </div>
            
            <!-- Start Game Button -->
            <div class="row mt-5">
                <div class="col-12 text-center">
                    <button class="btn start-btn" id="start-game-btn">
                        <i class="fas fa-play me-2"></i>
                        START GAME
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <div class="text-white-50 d-flex align-items-center justify-content-center gap-2">
                        <i class="fas fa-gamepad"></i>
                        <small>Click player icons to customize • Tap colors to change</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Color Picker Modal -->
    <div class="fullscreen-modal" id="color-picker-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeColorPicker()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-header">
                <h2 class="modal-title">Choose Color</h2>
                <div class="current-player" id="color-picker-player"></div>
            </div>
            
            <div class="color-grid" id="color-grid">
                <!-- Colors will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Icon Picker Modal -->
    <div class="fullscreen-modal" id="icon-picker-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeIconPicker()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-header">
                <h2 class="modal-title">Choose Icon</h2>
                <div class="current-player" id="icon-picker-player"></div>
            </div>
            
            <div class="icon-grid" id="icon-grid">
                <!-- Icons will be inserted here -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Game state
        let players = [
            { id: 1, name: 'MARIO', color: '#ff4444', icon: '🍄' },
            { id: 2, name: 'LUIGI', color: '#44ff44', icon: '⭐' },
            { id: 3, name: 'PEACH', color: '#ff69b4', icon: '👑' },
            { id: 4, name: 'TOAD', color: '#4169e1', icon: '🎯' }
        ];

        let editingPlayer = null;
        let currentPickerPlayer = null;

        const predefinedColors = [
            '#ff4444', '#44ff44', '#4444ff', '#ffff44',
            '#ff44ff', '#44ffff', '#ff8844', '#8844ff',
            '#ff4488', '#88ff44', '#4488ff', '#ffaa44',
            '#ff6b6b', '#4ecdc4', '#45b7d1', '#f39c12',
            '#e74c3c', '#2ecc71', '#9b59b6', '#34495e'
        ];

        const availableIcons = [
            '🍄', '⭐', '👑', '🎯', '🔥', '⚡', '💎', '🎮', 
            '🚀', '🎪', '🎨', '🎭', '🦄', '🐉', '👾', '🎲',
            '🏆', '⚔️', '🛡️', '🎸', '🎺', '🎪', '🎨', '🎭'
        ];

        // Utility functions
        function updatePlayerCount() {
            const playerCount = document.getElementById('player-count');
            playerCount.textContent = `${players.length} Player${players.length > 1 ? 's' : ''}`;
        }

        function addPlayer() {
            const newId = Math.max(...players.map(p => p.id)) + 1;
            const randomColor = predefinedColors[Math.floor(Math.random() * predefinedColors.length)];
            const randomIcon = availableIcons[Math.floor(Math.random() * availableIcons.length)];
            
            const newPlayer = {
                id: newId,
                name: `PLAYER ${newId}`,
                color: randomColor,
                icon: randomIcon
            };
            
            players.push(newPlayer);
            renderPlayers();
            updatePlayerCount();
        }

        function removePlayer(id) {
            if (players.length > 1) {
                players = players.filter(p => p.id !== id);
                renderPlayers();
                updatePlayerCount();
            }
        }

        function updatePlayer(id, field, value) {
            const player = players.find(p => p.id === id);
            if (player) {
                player[field] = value;
                renderPlayers();
            }
        }

        function createPlayerCard(player, index) {
            const isEditing = editingPlayer === player.id;
            
            return `
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6">
                    <div class="card player-card rounded-4 border-0 h-100 position-relative" 
                         style="border-color: ${player.color}40 !important;">
                        
                        <!-- Player Number -->
                        <div class="player-number" style="background-color: ${player.color}60; border-color: ${player.color}80;">
                            ${index + 1}
                        </div>
                        
                        <!-- Remove Button -->
                        ${players.length > 1 ? `
                            <button class="remove-btn" onclick="removePlayer(${player.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                        
                        <div class="card-body text-center p-4">
                            <!-- Player Icon -->
                            <div class="player-icon" 
                                 style="box-shadow: 0 0 20px ${player.color}40, inset 0 0 20px ${player.color}20;"
                                 onclick="openIconPicker(${player.id})">
                                ${player.icon}
                            </div>
                            
                            <!-- Player Name -->
                            ${isEditing ? `
                                <input type="text" 
                                       class="name-input" 
                                       value="${player.name}"
                                       style="--player-color: ${player.color};"
                                       onblur="finishEditing()"
                                       onkeypress="handleNameKeypress(event, ${player.id})"
                                       oninput="updatePlayerName(${player.id}, this.value)"
                                       id="name-input-${player.id}">
                            ` : `
                                <h5 class="player-name" 
                                    style="color: ${player.color}; text-shadow: 0 0 10px ${player.color}80;"
                                    onclick="startEditing(${player.id})">
                                    ${player.name}
                                </h5>
                            `}
                            
                            <!-- Color Circle -->
                            <div class="color-circle" 
                                 style="background-color: ${player.color};"
                                 onclick="openColorPicker(${player.id})">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createAddPlayerCard() {
            return `
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6">
                    <div class="card add-player-card rounded-4 border-0 h-100 d-flex align-items-center justify-content-center" 
                         onclick="addPlayer()">
                        <div class="text-center text-white">
                            <div class="player-icon mb-3">
                                <i class="fas fa-plus fa-2x text-white-50"></i>
                            </div>
                            <h5 class="text-white-50 fw-bold">ADD PLAYER</h5>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlayers() {
            const grid = document.getElementById('players-grid');
            const playerCards = players.map((player, index) => createPlayerCard(player, index)).join('');
            const addPlayerCard = createAddPlayerCard();
            
            grid.innerHTML = playerCards + addPlayerCard;
        }

        // Player editing functions
        function startEditing(playerId) {
            editingPlayer = playerId;
            renderPlayers();
            
            setTimeout(() => {
                const input = document.getElementById(`name-input-${playerId}`);
                if (input) {
                    input.focus();
                    input.select();
                }
            }, 10);
        }

        function finishEditing() {
            // Only finish editing if Enter was pressed or input lost focus intentionally
            if (editingPlayer) {
                editingPlayer = null;
                renderPlayers();
            }
        }

        function updatePlayerName(playerId, value) {
            const player = players.find(p => p.id === playerId);
            if (player) {
                player.name = value.toUpperCase();
                // Update just the input value without full re-render
                const input = document.getElementById(`name-input-${playerId}`);
                if (input) {
                    input.value = player.name;
                }
            }
        }

        function handleNameKeypress(event, playerId) {
            if (event.key === 'Enter') {
                finishEditing();
                event.preventDefault();  // Only prevent default for Enter key
            }
        }

        // Color picker functions
        function openColorPicker(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            currentPickerPlayer = playerId;
            
            // Update modal content
            const playerDisplay = document.getElementById('color-picker-player');
            playerDisplay.textContent = `${player.icon} ${player.name}`;
            playerDisplay.style.setProperty('--current-player-color', player.color);
            
            // Render color options
            const colorGrid = document.getElementById('color-grid');
            colorGrid.innerHTML = predefinedColors.map(color => `
                <div class="color-option ${player.color === color ? 'selected' : ''}" 
                     style="background-color: ${color};"
                     onclick="selectColor('${color}')">
                </div>
            `).join('');
            
            // Show modal
            document.getElementById('color-picker-modal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function selectColor(color) {
            if (currentPickerPlayer) {
                updatePlayer(currentPickerPlayer, 'color', color);
                closeColorPicker();
            }
        }

        function closeColorPicker() {
            document.getElementById('color-picker-modal').classList.remove('show');
            document.body.style.overflow = '';
            currentPickerPlayer = null;
        }

        // Icon picker functions
        function openIconPicker(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            currentPickerPlayer = playerId;
            
            // Update modal content
            const playerDisplay = document.getElementById('icon-picker-player');
            playerDisplay.textContent = `${player.icon} ${player.name}`;
            playerDisplay.style.setProperty('--current-player-color', player.color);
            
            // Render icon options
            const iconGrid = document.getElementById('icon-grid');
            iconGrid.innerHTML = availableIcons.map(icon => `
                <div class="icon-option ${player.icon === icon ? 'selected' : ''}" 
                     onclick="selectIcon('${icon}')">
                    ${icon}
                </div>
            `).join('');
            
            // Show modal
            document.getElementById('icon-picker-modal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function selectIcon(icon) {
            if (currentPickerPlayer) {
                updatePlayer(currentPickerPlayer, 'icon', icon);
                closeIconPicker();
            }
        }

        function closeIconPicker() {
            document.getElementById('icon-picker-modal').classList.remove('show');
            document.body.style.overflow = '';
            currentPickerPlayer = null;
        }

        // Close modals on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeColorPicker();
                closeIconPicker();
            }
        });

        // Close modals when clicking outside
        document.getElementById('color-picker-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeColorPicker();
            }
        });

        document.getElementById('icon-picker-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeIconPicker();
            }
        });

        // Start game handler
        document.getElementById('start-game-btn').addEventListener('click', function() {
            alert('Starting game with ' + players.length + ' players!\n\nPlayers:\n' + 
                  players.map(p => `${p.name} (${p.icon})`).join('\n'));
        });

        // Initial render
        renderPlayers();
        updatePlayerCount();
    </script>
</body>
</html>
