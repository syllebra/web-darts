<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Settings Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../dartnet/settings.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body>
    <!-- Floating Settings Button -->
    <div id="settingsButton" class="settings_floating-button" onclick="openSettingsModal()">
        <i class="fas fa-cog"></i>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade settings_modal" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title settings_modal-title" id="settingsModalLabel">
                        <i class="fas fa-cog me-2"></i>Advanced Settings
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs settings_nav-tabs" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="mqtt-tab" data-bs-toggle="tab" data-bs-target="#mqtt" type="button" role="tab">
                            <i class="fas fa-wifi me-1"></i>MQTT
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="dartvo-tab" data-bs-toggle="tab" data-bs-target="#dartvo" type="button" role="tab">
                            <i class="fas fa-eye me-1"></i>DartDetectorVO
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="dartvai-tab" data-bs-toggle="tab" data-bs-target="#dartvai" type="button" role="tab">
                            <i class="fas fa-wave-square me-1"></i>DartDetectorVAI
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="calibration-tab" data-bs-toggle="tab" data-bs-target="#calibration" type="button" role="tab">
                            <i class="fas fa-crosshairs me-1"></i>Calibration
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">
                            <i class="fas fa-sliders-h me-1"></i>General
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content settings_tab-content" id="settingsTabContent">
                    <!-- MQTT Tab -->
                    <div class="tab-pane fade show active" id="mqtt" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Broker IP Address</label>
                                    <input type="text" class="form-control settings_form-control" id="mqttBrokerIP" placeholder="192.168.1.100">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Port</label>
                                    <input type="number" class="form-control settings_form-control" id="mqttPort" placeholder="1883" min="1" max="65535">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Username (Optional)</label>
                                    <input type="text" class="form-control settings_form-control" id="mqttUsername" placeholder="username">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Password (Optional)</label>
                                    <input type="password" class="form-control settings_form-control" id="mqttPassword" placeholder="password">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DartDetectorVO Tab -->
                    <div class="tab-pane fade" id="dartvo" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Detection Model</label>
                                    <select class="form-select settings_form-select" id="dartvoModel">
                                        <option value="yolo">YOLO</option>
                                        <option value="ssd">SSD</option>
                                        <option value="rcnn">R-CNN</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Input Source</label>
                                    <input type="text" class="form-control settings_form-control" id="dartvoSource" placeholder="camera0">
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Confidence Threshold</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="dartvoConfidence" min="0" max="100" value="75">
                                        <span class="settings_slider-value" id="dartvoConfidenceValue">75%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">NMS Threshold</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="dartvoNMS" min="0" max="100" value="45">
                                        <span class="settings_slider-value" id="dartvoNMSValue">45%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DartDetectorVAI Tab -->
                    <div class="tab-pane fade" id="dartvai" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">AI Model Type</label>
                                    <select class="form-select settings_form-select" id="dartvaiModelType">
                                        <option value="transformer">Transformer</option>
                                        <option value="cnn">CNN</option>
                                        <option value="hybrid">Hybrid</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Processing Mode</label>
                                    <select class="form-select settings_form-select" id="dartvaiMode">
                                        <option value="realtime">Real-time</option>
                                        <option value="batch">Batch</option>
                                        <option value="hybrid">Hybrid</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Learning Rate</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="dartvaiLearningRate" min="1" max="100" value="30">
                                        <span class="settings_slider-value" id="dartvaiLearningRateValue">0.003</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Batch Size</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="dartvaiBatchSize" min="1" max="64" value="16">
                                        <span class="settings_slider-value" id="dartvaiBatchSizeValue">16</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calibration Tab -->
                    <div class="tab-pane fade" id="calibration" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Calibration Type</label>
                                    <select class="form-select settings_form-select" id="calibrationType">
                                        <option value="automatic">Automatic</option>
                                        <option value="manual">Manual</option>
                                        <option value="semi-auto">Semi-Automatic</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Reference Points</label>
                                    <input type="number" class="form-control settings_form-control" id="calibrationPoints" min="3" max="20" value="9">
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Accuracy Level</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="calibrationAccuracy" min="1" max="10" value="7">
                                        <span class="settings_slider-value" id="calibrationAccuracyValue">7</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Tolerance (px)</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="calibrationTolerance" min="1" max="20" value="5">
                                        <span class="settings_slider-value" id="calibrationToleranceValue">5px</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- General Tab -->
                    <div class="tab-pane fade" id="general" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Language</label>
                                    <select class="form-select settings_form-select" id="generalLanguage">
                                        <option value="en">English</option>
                                        <option value="fr">Français</option>
                                        <option value="de">Deutsch</option>
                                        <option value="es">Español</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label settings_form-label">Theme</label>
                                    <select class="form-select settings_form-select" id="generalTheme">
                                        <option value="dark">Dark</option>
                                        <option value="light">Light</option>
                                        <option value="auto">Auto</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Update Interval (ms)</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="generalUpdateInterval" min="50" max="1000" value="100">
                                        <span class="settings_slider-value" id="generalUpdateIntervalValue">100ms</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="settings_slider-container">
                                    <label class="form-label settings_form-label">Log Level</label>
                                    <div class="d-flex align-items-center">
                                        <input type="range" class="settings_slider" id="generalLogLevel" min="1" max="5" value="3">
                                        <span class="settings_slider-value" id="generalLogLevelValue">Info</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="settings_action-buttons">
                    <div class="d-flex justify-content-between">
                        <div>
                            <button type="button" class="btn settings_btn-success me-2" onclick="settingsManager.saveSettings()">
                                <i class="fas fa-save me-1"></i>Save Settings
                            </button>
                            <button type="button" class="btn settings_btn-glass me-2" onclick="settingsManager.loadSettings()">
                                <i class="fas fa-upload me-1"></i>Load Settings
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn settings_btn-glass me-2" onclick="settingsManager.resetSettings()">
                                <i class="fas fa-undo me-1"></i>Reset to Default
                            </button>
                            <button type="button" class="btn settings_btn-danger" onclick="settingsManager.exportSettings()">
                                <i class="fas fa-download me-1"></i>Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo content -->
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="text-center text-white">
                    <h1><i class="fas fa-bullseye me-3"></i>Dart Detection System</h1>
                    <p class="lead">Advanced dart detection system with AI-powered analysis</p>
                    <p>Click the settings button in the top-right corner to configure the system</p>
                    <p><small>Open browser console to see callback events in action!</small></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="../ui/global.js"></script>
    <script src="../dartnet/settings.js"></script>
    <script>
        function openSettingsModal() {
            console.log('Opening settings modal...');
            const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
            modal.show();
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: '#4CAF50',
                error: '#F44336',
                warning: '#FF9800',
                info: '#2196F3'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 80px; right: 20px; z-index: 1001;
                background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.2); border-radius: 10px;
                padding: 15px 20px; color: white; font-size: 14px;
                border-left: 4px solid ${colors[type]}; max-width: 300px;
                opacity: 0; transform: translateX(100%); transition: all 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            
            // // Setup slider listeners for visual updates
            // const sliders = document.querySelectorAll('.settings_slider');
            // sliders.forEach(slider => {
            //     slider.addEventListener('input', settingsManager.updateSliderValues());
            // });
            
            // Make button draggable
            makeDraggable('settingsButton', openSettingsModal);
            
            console.log('Initialization complete!');
        });

       

        // Create global instance for easy access - initialized after DOM loads
        let settingsManager;

        // Initialize settings manager after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit to ensure all elements are ready
            setTimeout(() => {
                settingsManager = new SettingsManager();

                // Example usage - register callbacks
                settingsManager.onSettingsChange((data) => {
                    console.log(`🔄 Change: ${data.category}.${data.key} = ${data.value}`);
                });

                settingsManager.onSettingsSave((data) => {
                    console.log('💾 Settings saved');
                });

                settingsManager.onSettingsLoad((data) => {
                    console.log('📁 Settings loaded');
                });

                settingsManager.onSettingsReset((data) => {
                    console.log('🔄 Settings reset');
                });

                settingsManager.onSettingsExport((data) => {
                    console.log('📤 Settings exported');
                });

                console.log('SettingsManager initialized with callbacks');
                console.log('Settings panel ready with working callbacks!');
                
                // Load saved settings or defaults
                settingsManager.loadSettings();
                console.log('Settings loaded');


                // Test the callbacks by programmatically changing a setting
                setTimeout(() => {
                    console.log('Testing callback by changing MQTT port...');
                    settingsManager.setSetting('mqtt', 'port', 1884);
                }, 2000);
            }, 100);
        });
    </script>
</body>
</html>
